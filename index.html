<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Počítač těšení🌈</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
        <link rel="stylesheet" href="./index.css">
        
    </head>
    <body>
        <div id="app"></div>
        <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>

        <script type="text/jsx">

            'use strict';

const e = React.createElement;


const bindings = ['což bude', 'kterou uvidím', 'kterého uvidím', 'co se stane'];
const storagePrefix = 'pleasure-counter-items';

class Counter extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            wish: 'něco super',
            when: undefined,
            binding: bindings[0],
            now: (new Date()).toISOString(),
            disabled: true,
            items: []
        };
    }

    componentDidMount() {
        const itemsFromStorage = localStorage.getItem(storagePrefix)
        if (itemsFromStorage && itemsFromStorage.length) {
            this.setState({...this.state, items: JSON.parse(itemsFromStorage).sort(this.sortFunction)})
        }
    }

    sortFunction = (a,b) => new Date(a.when).getTime() - new Date(b.when).getTime()

    render() {
        const items = this.state.items.map(item => <div key={item.timestamp}>{item.wish} {item.binding} {new Date(item.when).toLocaleString('cs-CS')}</div>)
        return (
            <div id="wishlist-counter-app">
              <h1>Počítač těšení🌈</h1>
              <div className="row">
                Těším se na <input type="text" placeholder="něco super" onChange={this.wishChanged}/>
              </div>
              <div className="row">
                což bude <input type="datetime-local" min={this.now} onChange={this.dateChanged} required></input>
              </div>
              <button disabled={!!this.isValid} onClick={this.saveWish}>Těšit se!</button>
              <button onClick={this.deleteAll}>Vše smazat</button>
              
            <div className="row">
                <h2>Na co už se těším?</h2>
               {items}
            </div>
            </div>
          );
    }

    componentDidUpdate = () => {
        //console.log(this.state);
        return true;
    }

    saveWish = () => {
        const newWish = {
            wish: this.state.wish,
            when: this.state.when,
            timestamp: (new Date()).getTime()
        }
        console.log(newWish)
        const withNewWish = [...this.state.items, newWish]

        localStorage.setItem(storagePrefix, JSON.stringify(withNewWish))
        this.setState({...this.state, items: withNewWish.sort(this.sortFunction)})
        console.log(this.state)
    }

    deleteAll = () => {
        localStorage.removeItem(storagePrefix);
        this.setState({...this.state, items: []})
    }

    wishChanged = (wish) => {
        this.setState({...this.state, wish: wish.target.value})
    }

    dateChanged = (date) => {
        //console.log(date.target.value);
        this.setState({...this.state, when: new Date(date.target.value)})
    }

}
        
ReactDOM.render(
    <Counter />,
    document.getElementById('app')
  );
        </script>

        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        
    </body>
</html>